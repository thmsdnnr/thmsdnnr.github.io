<!DOCTYPE html>
<html lang="en"><head>
	
	<meta name="generator" content="Hugo 0.76.0-DEV" />
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	
	<meta property="og:title" content="">
	<link rel="preload" href="/webfonts/Roboto-Regular.woff" as="font" type="font/woff2">
	<link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
	
	
	<meta name="keywords" content="full-stack overflow,dev blog,programming,tutorials"><meta name="description" content=""><meta property="og:title" content="" />
<meta property="og:description" content="Boids: A Bird Flock Simulator  let COHESION_FACTOR = 1 / 10e3 let TOO_CLOSE_MAGNITUDE = 10e2 let VELOCITY_MATCH_FACTOR = 10e-3 let SPEED_DENOM = 48 let fpsInterval = 1000 / SPEED_DENOM const VELOCITY_LIMIT = 10 const FLINGBACK_VELOCITY = 1 const BOID_HEIGHT = 5 const BOID_WIDTH = 5 const BOID_START_CT = 50 const scaleFactor = window.devicePixelRatio const MAX_X = Math.min(1600, (Math.floor(window.innerWidth / 1.1) * scaleFactor - 100)); const MAX_Y = Math.min(700, (Math.floor(window.innerHeight / 3) * scaleFactor - 100)); let c let ctx let boidList = [] let animFrameHandler function Boid (initialPosition, initialVelocity) { this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://thmsdnnr.com/homepage/" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Boids: A Bird Flock Simulator  let COHESION_FACTOR = 1 / 10e3 let TOO_CLOSE_MAGNITUDE = 10e2 let VELOCITY_MATCH_FACTOR = 10e-3 let SPEED_DENOM = 48 let fpsInterval = 1000 / SPEED_DENOM const VELOCITY_LIMIT = 10 const FLINGBACK_VELOCITY = 1 const BOID_HEIGHT = 5 const BOID_WIDTH = 5 const BOID_START_CT = 50 const scaleFactor = window.devicePixelRatio const MAX_X = Math.min(1600, (Math.floor(window.innerWidth / 1.1) * scaleFactor - 100)); const MAX_Y = Math.min(700, (Math.floor(window.innerHeight / 3) * scaleFactor - 100)); let c let ctx let boidList = [] let animFrameHandler function Boid (initialPosition, initialVelocity) { this."/>

	
	

	<title> | full-stack overflow ðŸ¥ž</title></head>
<body><header>
	
	<div id="avatar">
		<a href="https://thmsdnnr.com/">
			
			
			<svg version="1.1" id="emoji" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
				 viewBox="0 0 72 72" enable-background="new 0 0 72 72" xml:space="preserve" alt="full-stack overflow ðŸ¥ž" width="80px" height="80px">
			<g id="_xD83D__xDE38__1_">
				<path fill="#F4AA41" d="M58.7,49.7C55.1,58.8,46,64.9,35.5,64.9c-9.1,0-19.3-5.8-22.9-15l-0.1-0.3c-1.1-2.9-2-6.4-2-9.6l3.7-33.4
					l11.2,11.1c2.9-1.2,6.1-1.9,9.5-1.9H36c3.4,0,6.6,0.7,9.5,1.9L56.7,6.6l3.7,33.9C60.5,43.7,59.8,46.8,58.7,49.7"/>
				<path fill="#E27022" d="M35.5,64.9c10.6,0.3,20.4-6,24-15.1l0.1-0.2c1.1-2.9,2-6.9,2-10.2L56.7,6.6"/>
					<line fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" x1="62" y1="54.9" x2="52.6" y2="49.7"/>
				<path fill="none" stroke="#1D1D1B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
					M52.6,47.7"/>
					<line fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" x1="57.8" y1="60.1" x2="48.5" y2="54.9"/>
				<path fill="none" stroke="#1D1D1B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
					M46.4,56"/>
				<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
					M13.3,48.8c-1.1-2.8-1.7-5.8-1.7-9l3.6-32.8l11,10.7c2.9-1.2,6-1.9,9.3-1.9h1c3.3,0,6.4,0.7,9.3,1.9l11-10.7l3.6,32.8
					c0,3.2-0.6,6.2-1.7,9"/>
					<line fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" x1="10" y1="54.9" x2="19.4" y2="49.7"/>
				<path fill="none" stroke="#1D1D1B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
					M19.4,47.7"/>
					<line fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" x1="14.2" y1="60.1" x2="23.5" y2="54.9"/>
				<path fill="none" stroke="#1D1D1B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
					M25.6,56"/>
					<line fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" x1="31.8" y1="46.3" x2="40.2" y2="46.3"/>
					<path fill="#EA5A47" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
					M25.6,49.4c0,0,7.8,4.2,10.4-3.1c2.6,7.3,10.8,3.1,10.8,3.1s-2.7,4.4-3.5,5.2c-4,4.3-9.4,4.1-13.7,0.1
					C28.7,53.8,25.6,49.4,25.6,49.4z"/>
				<path fill="none" stroke="#1D1D1B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
					M55.7,61"/>
				<path fill="none" stroke="#1D1D1B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
					M16.3,61"/>
				<path fill="none" stroke="#1D1D1B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
					M55.7,61"/>
				<path fill="none" stroke="#1D1D1B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
					M16.3,61"/>
				<path fill="none" stroke="#1D1D1B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
					M64,56.1"/>
				<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
					M22.9,60.2c3.7,2.3,8,3.6,12.6,3.6h1c4.6,0,9-1.3,12.6-3.6"/>
				<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
					M55.2,38.6c-3.1-4.2-9.3-4.2-11.4,0"/>
				<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
					M16.8,38.6c3.1-4.2,9.3-4.2,11.4,0"/>
			</g>
			</svg>
		</a>
	</div>
	
	<div id="titletext"><h2 id="title"><a href="https://thmsdnnr.com/">full-stack overflow ðŸ¥ž</a></h2></div>
	<div id="title-description"><p id="subtitle">writing code ðŸ¤– drinking coffee â˜• petting cats ðŸ˜º wearing masks ðŸ˜·</p><div id="social">
			<nav>
				<ul></ul>
			</nav>
		</div>
	</div>
	
	<div id="mainmenu">
		<nav>
			<ul>
				
				<li><a href="/projects">Projects</a></li>
				
				<li><a href="/post">Blog</a></li>
				
				<li><a href="/tags">Tags</a></li>
				
				<li><a href="/categories">Categories</a></li>
				
				<li><a href="https://github.com/thmsdnnr">GitHub</a></li>
				
			</ul>
		</nav>
	</div>
	
</header>
<main><div class="post">
	
	<div class="author">
	
	</div>
	<div class="post-header">
	
		<div class="matter">
			<h1 class="title"></h1>
		</div>
	</div>
	<div class="markdown">
		<h2 id="boids-a-bird-flock-simulator">Boids: A Bird Flock Simulator</h2>
<script>

let COHESION_FACTOR = 1 / 10e3 
let TOO_CLOSE_MAGNITUDE = 10e2 
let VELOCITY_MATCH_FACTOR = 10e-3 
let SPEED_DENOM = 48
let fpsInterval = 1000 / SPEED_DENOM


const VELOCITY_LIMIT = 10
const FLINGBACK_VELOCITY = 1
const BOID_HEIGHT = 5
const BOID_WIDTH = 5
const BOID_START_CT = 50
const scaleFactor = window.devicePixelRatio
const MAX_X = Math.min(1600, (Math.floor(window.innerWidth / 1.1) * scaleFactor - 100));
const MAX_Y = Math.min(700, (Math.floor(window.innerHeight / 3) * scaleFactor - 100));


let c
let ctx
let boidList = []
let animFrameHandler

function Boid (initialPosition, initialVelocity) {
  this.position = initialPosition || new V2(0, 0)
  this.velocity = initialVelocity || new V2(0, 0)
  Boid.numInstances = (Boid.numInstances || 0) + 1
  this.id = Boid.numInstances 
  this.normalizePosition = (maxX, maxY) => {
    
    if (this.position.x < BOID_WIDTH) {
      this.velocity.x += FLINGBACK_VELOCITY
    } else if (this.position.x > MAX_X - BOID_WIDTH) {
      this.velocity.x += -1 * FLINGBACK_VELOCITY
    }
    
    if (this.position.y < 5 - BOID_WIDTH) {
      this.velocity.y += FLINGBACK_VELOCITY
    } else if (this.position.y > MAX_Y - BOID_WIDTH) {
      this.velocity.y += -1 * FLINGBACK_VELOCITY
    }
  }
  this.draw = ctx => {
    ctx.fillStyle = 'gold'
    ctx.fillRect(
      (this.position.x + BOID_WIDTH / 2) / scaleFactor,
      (this.position.y + BOID_HEIGHT / 2) / scaleFactor,
      BOID_WIDTH,
      BOID_HEIGHT
    )
  }
}

function V2 (x, y) {
  
  this.x = x || 0
  this.y = y || 0

  this.add = addedVector =>
    new V2(this.x + addedVector.x, this.y + addedVector.y)
  this.subtract = subtractedVector =>
    new V2(this.x - subtractedVector.x, this.y - subtractedVector.y)
  this.multiply = magnitude => new V2(this.x * magnitude, this.y * magnitude)
  this.magnitude = () => Math.sqrt(Math.pow(this.x, 2) + Math.pow(this.y, 2))
}

function rule1 (boid, boidList) {
  
  let theOtherBoids = boidList.filter(boidId => boid.id != boidId.id)
  let avgPosition = new V2()
  theOtherBoids.forEach(boid => (avgPosition = avgPosition.add(boid.position)))
  return avgPosition
    .multiply(1 / theOtherBoids.length)
    .subtract(boid.position)
    .multiply(COHESION_FACTOR)
}

function rule2 (boid, boidList) {
  
  let newPositionVector = new V2()
  boidList
    .filter(boidId => boid.id !== boidId.id)
    .map(otherBoid => otherBoid.position)
    .filter(
      otherBoidPosition =>
        otherBoidPosition.subtract(boid.position).magnitude() <
        TOO_CLOSE_MAGNITUDE
    )
    .map(tooCloseBoid =>
      newPositionVector.subtract(tooCloseBoid.subtract(boid.position))
    )
  return newPositionVector
}

function rule3 (boid, boidList) {
  
  return boidList
    .filter(boidId => boid.id !== boidId.id)
    .map(otherBoid => otherBoid.velocity)
    .reduce((boidA, boidB) => boidA.add(boidB), new V2())
    .multiply(1 / boidList.length)
    .multiply(VELOCITY_MATCH_FACTOR)
}

const limitVelocity = v =>
  (v.magnitude() > VELOCITY_LIMIT ? v.multiply(1 / (v.magnitude() * VELOCITY_LIMIT)) : v)

function updateBoidPositions (boidList) {
  boidList.forEach(boid => {
    boid.velocity = limitVelocity(
      boid.velocity.add(
        rule1(boid, boidList)
          .add(rule2(boid, boidList))
          .add(rule3(boid, boidList))
      )
    )
    
    boid.position = boid.position.add(boid.velocity)
    
    boid.normalizePosition(MAX_X, MAX_Y)
  })
}

const drawBoidList = (boidList, ctx) => boidList.forEach(boid => boid.draw(ctx))

function fillBoidList () {
  
  let list = []
  for (var i = 0; i < BOID_START_CT; i++) {
    
    let dir = Math.random() > 0.5 ? 1 : -1
    list.push(
      new Boid(
        new V2(MAX_X / 2 + Math.random() * 25, MAX_Y / 2 + Math.random() * 25),
        new V2(5 * Math.random() * dir, 5 * Math.random() * dir)
      )
    )
  }
  return list
}

function setUpWindow () {
  
  document
    .getElementById('reset')
    .addEventListener('click', resetBoidsAndStartAnimationFrames)
  document.getElementById('rule_1').addEventListener('change', e => {
    COHESION_FACTOR = 1 / Math.pow(10, e.target.value)
  })
  document.getElementById('rule_2').addEventListener('change', e => {
    TOO_CLOSE_MAGNITUDE = Math.pow(10, e.target.value)
  })
  document.getElementById('rule_3').addEventListener('change', e => {
    VELOCITY_MATCH_FACTOR = 1 / Math.pow(10, e.target.value)
  })
  document.getElementById('speed').addEventListener('change', e => {
    SPEED_DENOM = e.target.value
    fpsInterval = 1000 / SPEED_DENOM
  })
  
  c = document.getElementById('birdflock')
  c.width = MAX_X
  c.height = MAX_Y
  c.style.width = `${c.width / scaleFactor}px`
  c.style.height = `${c.height / scaleFactor}px`
  ctx = c.getContext('2d')
  ctx.translate(0.5, 0.5)
  ctx.scale(scaleFactor, scaleFactor)
}

function resetBoidsAndStartAnimationFrames () {
  if (animFrameHandler) {
    window.cancelAnimationFrame(animFrameHandler)
  }
  boidList = fillBoidList()
  animFrameHandler = window.requestAnimationFrame(step)
}

function fly () {
  setUpWindow()
  resetBoidsAndStartAnimationFrames()
}


let then = Date.now()

function step () {
  window.requestAnimationFrame(step)
  now = Date.now()
  elapsed = now - then
  if (elapsed < fpsInterval) {
    return
  }
  then = now - elapsed % fpsInterval
  ctx.clearRect(0, 0, c.width, c.height)
  ctx.fillStyle = 'black'
  ctx.fillRect(0, 0, c.width, c.height)
  updateBoidPositions(boidList)
  drawBoidList(boidList, ctx)
}


document.addEventListener('DOMContentLoaded', fly);
</script>

<style>
    body {
        font-family: 'Roboto Regular', monospace;
    }

    button {
        font-family: 'Roboto Regular', monospace;
        font-size: 1rem;
    }

    div#controls, div#controls div {
        margin: auto;
        display: flex;
        flex-flow: row wrap;
        align-items: center;
        justify-content: flex-start;
        font-size: 0.9rem;
        flex: 1;
    }
    canvas#birdflock {
        margin: auto;
        border: 1px solid gold;
    }
    input {
        min-height: 48px;
        min-width: 48px;
    }
</style>

<canvas id="birdflock" class="highlight"></canvas>
<div id="controls">
    <div>
        <input type="range" value="6" min="1" max="10" step="1" id="rule_1">
        <label for="rule_1">Separation</label>
        <input type="range" value="2" min="1" max="100" id="rule_2">
        <label for="rule_2">Alignment</label>
    </div>
    <div>
        <input type="range" value="3" min="1" max="10" id="rule_3">
        <label for="rule_3">Velocity Sync</label>
        <input type="range" value="48" min="1" max="48" id="speed">
        <label for="speed">Speed</label>
    </div>
    <div>
        <button id="reset">RESET</button>
    </div>
</div>

<h3 id="learn-more">Learn More</h3>
<p><a href="https://thmsdnnr.com/post/boids-a-bird-flock-simulator/" target="_blank" rel="noreferrer noopener">blog post</a>
 // <a href="https://github.com/thmsdnnr/boids/" target="_blank" rel="noreferrer noopener">GitHub Repo</a>
</p>

	</div>
	
	
	
	
	
		
	
		
	
		
		
	</div></div>

  </main>
<footer>
	 Â© 2017-2020 thomas danner // <a href="https://github.com/dataCobra/hugo-vitae">Vitae</a> theme for <a href="https://gohugo.io">Hugo</a> 
	
	
	
</footer>


</body>
</html>
